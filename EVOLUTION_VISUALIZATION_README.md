# Enhanced Agent Battle Evolution with Family Tree Visualization

This system runs evolutionary simulations of AI agents competing in negotiation games and generates comprehensive visualizations showing both balance evolution and strategy lineage.

## 🚀 Quick Start

### Run Full Evolution with Visualization
```bash
# Run 5 tournaments with 8 games each (40 total games)
node runFullEvolutionWithVisualization.js

# Custom parameters: 3 tournaments with 5 games each
node runFullEvolutionWithVisualization.js 3 5

# Short test run: 2 tournaments with 3 games each  
node runFullEvolutionWithVisualization.js 2 3
```

### Visualize Existing Evolution Data
```bash
# Create charts from any evolution JSON file
python3 visualize_evolution_tree.py enhanced_evolution_2025-05-30T15-46-06-961Z.json
```

## 📊 Generated Visualizations

The system generates **3 comprehensive charts**:

### 1. 📈 Balance Evolution Chart
- Shows coin balance over time for each strategy
- Displays tournament boundaries and elimination points
- Color-coded lines for each strategy
- Shows profit/loss relative to starting balance

### 2. 🧬 Strategy Evolution Family Tree
- Visual family tree showing parent-child relationships
- Blue nodes = Core strategies (original 6)
- Green nodes = Evolved strategies (LLM-generated)
- Line thickness = Inheritance weight (how much influence each parent had)
- Organized by generation (Gen 0, Gen 1, Gen 2, etc.)

### 3. 📋 Strategy Details Table
- Complete details of all strategies including:
  - Strategy description text
  - Parent strategies with inheritance weights
  - Which eliminated strategies they avoid
  - Final performance metrics
  - Generation and archetype

## 🧬 How Evolution Works

### Core Strategies (Generation 0)
The simulation starts with 6 core strategies:
- **Aggressive Maximizer**: Demands large shares, uses threats
- **Diplomatic Builder**: Builds trust through fair offers  
- **Strategic Opportunist**: Adapts rapidly, forms/breaks alliances
- **Mathematical Analyzer**: Makes decisions based on probability
- **Social Manipulator**: Uses psychological tactics
- **Strategy Identifier**: Analyzes opponents to counter them

### Evolution Process
1. **Performance Tracking**: Strategies earn/lose coins based on game results
2. **Elimination**: Bottom 2 performers or bankrupt strategies (< 100 coins) are eliminated
3. **LLM Evolution**: New strategies are generated by:
   - Analyzing top performers and their profit-weighted influence
   - Explicitly avoiding eliminated strategy patterns  
   - Creating competitive counters to current meta
   - Using real LLM reasoning (not hardcoded templates)

### Example Evolution
```
Tournament 1: Core strategies compete
→ Social Manipulator eliminated (too chaotic)
→ Strategy Identifier eliminated (ineffective analysis)

Tournament 2: LLM creates new strategies:
→ "Strategic Harmonizer": 67% Aggressive Maximizer + 33% Diplomatic Builder
→ "Adaptive Counter": Designed to exploit coalition weaknesses

Tournament 3: New meta emerges...
```

## 🔧 Key Features

### Enhanced Lineage Tracking
- **Parent-Child Relationships**: Each evolved strategy knows its parents and inheritance weights
- **Avoidance Patterns**: Tracks which eliminated strategies to avoid
- **Generation Tracking**: Clear generational hierarchy
- **Performance Inheritance**: Successful strategies influence their children more

### Intelligent LLM Evolution
- **Profit-Weighted Influence**: More successful strategies have more influence on offspring
- **Competitive Design**: New strategies designed to counter existing meta
- **Pattern Avoidance**: Explicitly avoids patterns that led to elimination
- **Game-Aware**: Understands 61% voting threshold, coalition dynamics, etc.

### Comprehensive Visualization
- **Balance Timeline**: Track wealth over 100+ games
- **Family Trees**: Visual inheritance relationships
- **Strategy Details**: Complete lineage and performance data
- **Multi-Format Support**: Works with old and new data formats

## 📁 File Structure

```
enhancedEvolutionarySystem.js     # Core evolution engine
visualize_evolution_tree.py       # Visualization generator  
runFullEvolutionWithVisualization.js  # One-click evolution + charts
testEvolutionSystem.js            # Quick evolution test
llmApi.js / agentInvoker.js       # LLM integration
enhanced_evolution_*.json         # Evolution data files
balance_evolution_*.png           # Balance charts
strategy_evolution_tree_*.png     # Family tree charts  
strategy_details_table_*.png      # Strategy details
```

## 🔬 Example Insights

### Successful Evolution Patterns
- **Hybrid Strategies**: Combinations often outperform pure archetypes
- **Defensive Adaptation**: Strategies that counter aggressive tactics succeed
- **Coalition Builders**: Understanding voting mechanics is crucial
- **Meta Evolution**: Strategies evolve to counter current dominant approaches

### Failed Patterns
- **Pure Manipulation**: Chaos-focused strategies get eliminated
- **Over-Analysis**: Complex pattern recognition without action fails
- **Static Approaches**: Strategies that don't adapt get outcompeted

## 🛠️ Troubleshooting

### Common Issues
1. **API Rate Limits**: Reduce tournament/game count or wait between runs
2. **Missing Dependencies**: Install matplotlib, pandas, networkx, numpy
3. **Font Warnings**: Emoji display warnings are cosmetic, charts still generate
4. **Memory Issues**: Large simulations generate big files, ensure adequate disk space

### Performance Tips
- Start with 2-3 tournaments for testing
- Use 3-5 games per tournament for development
- Full runs: 5-8 tournaments with 8-10 games each
- Monitor API usage to avoid rate limits

## 📈 Advanced Usage

### Custom Evolution Parameters
```javascript
// In runFullEvolutionWithVisualization.js
const result = await runEnhancedEvolution(
  numberOfTournaments,    // How many evolution cycles
  gamesPerTournament     // Games per tournament (more = better data)
);
```

### Visualization Customization
```python
# In visualize_evolution_tree.py
# Modify color schemes, layout, or chart types
# Add new analysis metrics or visualization types
```

### Data Analysis
```javascript
// Access raw evolution data
const data = require('./enhanced_evolution_2025-05-30T15-46-06-961Z.json');
// Analyze strategy performance, evolution patterns, etc.
```

## 🎯 Next Steps

1. **Run Your First Evolution**: `node runFullEvolutionWithVisualization.js 2 3`
2. **Examine the Charts**: Open the generated PNG files
3. **Analyze Patterns**: Look for successful evolution strategies
4. **Scale Up**: Run longer simulations to see complex evolution
5. **Experiment**: Try different tournament sizes and parameters

The system provides deep insights into how AI strategies evolve, compete, and adapt in strategic negotiation environments! 🚀 